<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin:0;padding:0;background-color:#f5f5f5;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
  <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f5f5f5;padding:20px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" style="background-color:#ffffff;border-radius:8px;overflow:hidden;">
          <!-- Header -->
          <tr>
            <td style="background-color:#1a1a2e;padding:24px 32px;">
              <h1 style="color:#ffffff;margin:0;font-size:22px;">ğŸ“š Your Learning Digest</h1>
              <p style="color:#a0a0b0;margin:8px 0 0;font-size:14px;">{{ digest_date }} Â· {{ total_items }} items scored</p>
            </td>
          </tr>

          {% if top_items %}
          <!-- Top 3 Must-Reads -->
          <tr>
            <td style="padding:24px 32px 8px;">
              <h2 style="color:#1a1a2e;font-size:18px;margin:0 0 16px;border-bottom:2px solid #e8e8e8;padding-bottom:8px;">â­ Must-Read</h2>
            </td>
          </tr>
          {% for item in top_items %}
          <tr>
            <td style="padding:4px 32px 16px;">
              <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f8f9fa;border-radius:6px;border-left:4px solid #667eea;padding:16px;">
                <tr>
                  <td>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                      <span style="font-size:12px;color:#667eea;font-weight:600;text-transform:uppercase;">{{ item.source }}</span>
                      <span style="font-size:13px;color:#888;font-weight:600;">Score: {{ item.score }}/10</span>
                    </div>
                    <a href="{{ item.url }}" style="color:#1a1a2e;font-size:16px;font-weight:600;text-decoration:none;line-height:1.3;">{{ item.title }}</a>
                    {% if item.author %}
                    <p style="color:#888;font-size:13px;margin:4px 0;">by {{ item.author }}</p>
                    {% endif %}
                    <p style="color:#555;font-size:14px;margin:8px 0;line-height:1.5;">{{ item.justification }}</p>
                    <div style="margin-top:12px;">
                      <a href="{{ item.url }}" style="display:inline-block;background-color:#667eea;color:#ffffff;padding:8px 16px;border-radius:4px;text-decoration:none;font-size:13px;font-weight:500;margin-right:8px;">Read â†’</a>
                      <a href="{{ item.feedback_useful_url }}" style="display:inline-block;background-color:#48bb78;color:#ffffff;padding:8px 12px;border-radius:4px;text-decoration:none;font-size:13px;margin-right:4px;">ğŸ‘ Useful</a>
                      <a href="{{ item.feedback_not_useful_url }}" style="display:inline-block;background-color:#e53e3e;color:#ffffff;padding:8px 12px;border-radius:4px;text-decoration:none;font-size:13px;">ğŸ‘ Not Useful</a>
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          {% endfor %}
          {% endif %}

          {% if remaining_items %}
          <!-- Remaining Items -->
          <tr>
            <td style="padding:24px 32px 8px;">
              <h2 style="color:#1a1a2e;font-size:18px;margin:0 0 16px;border-bottom:2px solid #e8e8e8;padding-bottom:8px;">ğŸ“‹ Also Worth Reading</h2>
            </td>
          </tr>
          {% for item in remaining_items %}
          <tr>
            <td style="padding:4px 32px 12px;">
              <table width="100%" cellpadding="0" cellspacing="0" style="border-bottom:1px solid #eee;padding-bottom:12px;">
                <tr>
                  <td>
                    <span style="font-size:11px;color:#888;text-transform:uppercase;">{{ item.source }} Â· Score: {{ item.score }}/10</span>
                    <br>
                    <a href="{{ item.url }}" style="color:#1a1a2e;font-size:15px;font-weight:500;text-decoration:none;">{{ item.title }}</a>
                    <p style="color:#666;font-size:13px;margin:4px 0;">{{ item.justification }}</p>
                    <div style="margin-top:8px;">
                      <a href="{{ item.feedback_useful_url }}" style="color:#48bb78;font-size:12px;text-decoration:none;margin-right:12px;">ğŸ‘ Useful</a>
                      <a href="{{ item.feedback_not_useful_url }}" style="color:#e53e3e;font-size:12px;text-decoration:none;">ğŸ‘ Not Useful</a>
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          {% endfor %}
          {% endif %}

          {% if not top_items and not remaining_items %}
          <tr>
            <td style="padding:32px;text-align:center;">
              <p style="color:#888;font-size:16px;">No items matched your learning context today. Try broadening your goals or adding more sources.</p>
            </td>
          </tr>
          {% endif %}

          <!-- Footer -->
          <tr>
            <td style="background-color:#f8f9fa;padding:20px 32px;border-top:1px solid #eee;">
              <p style="color:#888;font-size:13px;margin:0;text-align:center;">
                Your feedback helps improve future recommendations.
                {% if context_update_url %}
                <br><a href="{{ context_update_url }}" style="color:#667eea;">Update your learning context â†’</a>
                {% endif %}
              </p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
